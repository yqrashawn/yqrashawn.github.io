  <!DOCTYPE html>
  <html xmlns="http://www.w3.org/1999/xhtml">
  <head>
  <meta charset="UTF-8">

  <meta name="author" content="yqrashawn" />
  <meta name="generator" content="lazyblorg" />
  <meta name="description" content="Record Org-mode Recent Activity" />
  <meta name="orgmode-id" content="2018-09-17-record-org-mode-recent-activity" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@yqrashawn" />
  <meta name="twitter:creator" content="@yqrashawn" />
  <meta name="twitter:title" content="infin" />
  <meta name="twitter:description" content="Record Org-mode Recent Activity" />
  <meta name="twitter:image" content="//yqrashawn.com/public/img/YQ_logo.png" />

  <meta property="og:type" content="article" />
  <meta property="og:title" content="infin" />
  <meta property="og:description" content="Record Org-mode Recent Activity" />
  <meta property="og:image" content="//yqrashawn.com/public/img/YQ_logo.png" />
  <meta property="og:site_name" content="infin - Web-page of yqrashawn">
  <meta property="article:published_time" content="2018-09-17T22:25+08:00" />
  <meta property="article:author" content="yqrashawn" />

  <link rel="stylesheet" title="infin Standard CSS Style"
        href="//yqrashawn.com/public/css/YQ.css" type="text/css" media="screen"  />

  <link rel="alternate" type="application/atom+xml"
        title="infin (links only)" href="//yqrashawn.com/feeds/lazyblorg-all.atom_1.0.links-only.xml" />
  <link rel="alternate" type="application/atom+xml"
        title="infin (article teasers)" href="//yqrashawn.com/feeds/lazyblorg-all.atom_1.0.links-and-teaser.xml" />
  <link rel="alternate" type="application/atom+xml"
        title="infin (full content)" href="//yqrashawn.com/feeds/lazyblorg-all.atom_1.0.links-and-content.xml" />
  <script type="text/javascript" src="//yqrashawn.com/public/js/highlight.pack.js"></script>
  <script type="text/javascript" src="//yqrashawn.com/public/js/menu.js"></script>

  <!-- WARNING: This page is written in HTML5 and might not be displayed correctly in old browsers. -->

      <!-- link rel="stylesheet" type="text/css" href="../../../../style.css" / -->
      <title>Record Org-mode Recent Activity</title>

  </head>  <body>



	<header>

	  <nav class="temporal-article-header-nav">
	    <span class="breadcrumbs">
	      <a href="../../../../">infin</a><span style="padding-top:1em;">&nbsp;&nbsp;&nbsp;&nbsp;&raquo;
	      <a href="../../../">2018</a>&nbsp;&ndash;&nbsp;<a href="../../">09</a>&nbsp;&ndash;&nbsp;<a href="../">17</a></span>
	    </span>
	  </nav>
	  <aside class="common-tags">
	    <ul>
                <li><a class="usertag" href="//yqrashawn.com/tags/org-mdoe/">org-mdoe</a></li>
                <li><a class="usertag" href="//yqrashawn.com/tags/emacs/">emacs</a></li>
	    </ul>
	  </aside>

	  <h1 class="common-article-header-title">Record Org-mode Recent Activity</h1>

	</header>

  
  <div class="menu-espanso">
    <div id="menu-group">
      <div id="menu" class="menu">
      <div id="menu-in" class="menu-in"></div>
      </div>
      <span class="menu-closer"></span>
      <span class="linee linea1"></span>
      <span class="linee linea2"></span>
      <span class="linee linea3"></span>
    </div>
    <div class="voci-menu">
      <ul>
         <a id="show-sidebar-text" href="#show-sidebar">Show Sidebar</a>
         <div class="sidebar toggle-sidebar">


           <ul>
           <li><a href="../../../../about">About</a></li>
           <li><a href="//duckduckgo.com/?q=site%3A+yqrashawn.com+++">Search infin</li>
           <li>Subscribe</li>
               <ul>
               <li><span style="font-size:small"><a href="//yqrashawn.com/feeds/lazyblorg-all.atom_1.0.links-only.xml">links only</a> (most reliable)</span></li>
               <li><span style="font-size:small"><a href="//yqrashawn.com/feeds/lazyblorg-all.atom_1.0.links-and-teaser.xml">article teaser</a></span></li>
               <li><span style="font-size:small"><a href="//yqrashawn.com/feeds/lazyblorg-all.atom_1.0.links-and-content.xml">full content</a></span></li>
               </ul>
           <li id="top-tags">Top <a href="//yqrashawn.com/tags/">tags</a>:</li>
               <ul class="top-tags-list">
                     
              <li><a class="usertag" href="//yqrashawn.com/tags/emacs">emacs</a> (6)</li>
              <li><a class="usertag" href="//yqrashawn.com/tags/tool">tool</a> (3)</li>
              <li><a class="usertag" href="//yqrashawn.com/tags/workspace">workspace</a> (2)</li>
              <li><a class="usertag" href="//yqrashawn.com/tags/coding">coding</a> (2)</li>
              <li><a class="usertag" href="//yqrashawn.com/tags/macos">macos</a> (1)</li>
              <li><a class="usertag" href="//yqrashawn.com/tags/shell">shell</a> (1)</li>
              <li><a class="usertag" href="//yqrashawn.com/tags/chinese">chinese</a> (1)</li>
              <li><a class="usertag" href="//yqrashawn.com/tags/watching">watching</a> (1)</li>
              <li><a class="usertag" href="//yqrashawn.com/tags/efficient">efficient</a> (1)</li>
              <li><a class="usertag" href="//yqrashawn.com/tags/zsh">zsh</a> (1)</li>
               </ul>
           </ul>
         </div>
      </ul>
    </div>
  </div>



  <article class="common-article">

<p>

So I checked the <a href="https://www.notion.so/">notion</a> tool recently. It's pretty good if everyone around use it. But as an emacs user, I still prefer org-mode.

</p>

<p>

It's just there's one functionality I never thought about when I was using org-mode, the ability to record your activity. Like when you reschedule somthing or change the state of tasks.

</p>

<p>

I did some search online and came up with a solution. I'm pretty sure there's better ways to do so. I'll just put the codes here. It leverages the <code>org-agenda-custom-commands</code> and the <code>:LOGBOOK:</code> feature. And the code is mainly from <a href="https://stackoverflow.com/questions/8039416/custom-searches-using-timestamps-in-logbook-in-org-mode">here</a> with some modification.

</p>

	  <div class="example_code">
	  <pre>
    <code>;; enable the log feature
(setq org-log-into-drawer t)
(setq org-log-reschedule 'time)
(setq org-log-redeadline 'note)
(setq org-log-note-clock-out t)

;; add T: before timestamp for easy regex search
(setq org-log-note-headings '((done . "CLOSING NOTE T:%t")
                              (state . "State %-12s from %-12S T:%t")
                              (note . "Note taken on T:%t")
                              (reschedule . "Rescheduled from %S on T:%t")
                              (delschedule . "Not scheduled, was %S on T:%t")
                              (redeadline . "New deadline from %S on T:%t")
                              (deldeadline . "Removed deadline, was %S on T:%t")
                              (refile . "Refiled on T:%t")
                              (clock-out . "Clocked out on T:%t")))

(defun +org/find-state (&amp;optional end)
  "Used to search through the logbook of subtrees.

    Looking for T:[2018-09-14 Fri 10:50] kind of time stamp in logbook."
  (let* ((closed (re-search-forward "^CLOSED: \\[" end t))
         (created (if (not closed) (re-search-forward "^:CREATED: \\[" end t)))
         (logbook (if (not closed) (re-search-forward ".*T:\\[" end t)))
         (result (or closed logbook created)))
    result))

(defun +org/date-diff (start end &amp;optional compare)
  "Calculate difference between  selected timestamp to current date.

  The difference between the dates is calculated in days.
  START and END define the region within which the timestamp is found.
  Optional argument COMPARE allows for comparison to a specific date rather than to current date."
  (let* ((start-date (if compare compare (calendar-current-date))))
    (- (calendar-absolute-from-gregorian start-date) (org-time-string-to-absolute (buffer-substring-no-properties start end)))))

(defun +org/last-update-before (since)
  "List Agenda items that updated before SINCE day."
  (let ((next-headline (save-excursion (or (outline-next-heading) (point-max)))))
    (let* ((subtree-end (save-excursion (org-end-of-subtree t)))
           (subtree-valid (save-excursion
                            (forward-line 1)
                            (if (and (&lt; (point) subtree-end)
                                     ;; Find the timestamp to test
                                     (+org/find-state subtree-end))
                                (let ((startpoint (point)))
                                  (forward-word 3)
                                  ;; Convert timestamp into days difference from today
                                  (+org/date-diff startpoint (point)))
                              (point-max)))))
      (if (and subtree-valid (&gt;= subtree-valid since))
          next-headline
        nil))))

(defun +org/has-child-and-last-update-before (day)
  (if (+org/has-child-p) (point)
    (+org/last-update-before day)))    </code>
	  </pre>
    </div>

<p>

So now we can use the <code>+org/last-update-before</code> or <code>+org/has-child-and-last-update-before</code> function in <code>org-agenda-custom-commands</code> to filter activities updated since <code>SINCE</code> days ago. Like this.

</p>

	  <div class="example_code">
	  <pre>
    <code>(setq org-agenda-custom-commands
      '(("R" "Recent activity"
         ((tags "*"
                ((org-agenda-overriding-header "Recent Activity")
                 (org-agenda-skip-function '(+org/has-child-and-last-update-before 7)))))
         nil nil)))    </code>
	  </pre>
    </div>

<p>

The code will only search for timestamps in ":LOGBOOK:" prefexd with <code>T:</code> or <code>:CREATED:</code> or <code>:CLOSED</code> timestamps. It works fine and helps me sometimes. Maybe I should write a agenda sort function to let them ordered by changed time. Fine for me right now.

</p>

<p>

UPDATE: 2018-09-24 If anyone intrested in automatically recoding changes of headings, you may want check <a href="https://emacs.stackexchange.com/questions/39348/org-auto-add-update-date-of-last-modification-of-heading-and-or-its-body-to#">this</a> stackoverflow question. The answer gives a method using hash to record last modification time of any changes in headings or even bodys.

</p>


  </article>
	  <aside class="published-on">
	    Published on <time datetime="2018-09-17T22:25+08:00">2018-09-17T22:25</time>
	  </aside>

   <p class="email-comment">
      <a href="mailto:hi@yqrashawn.com?subject=2018-09-17-record-org-mode-recent-activity%20comment:%20&body=Please%20do%20not%20remove%20'2018-09-17-record-org-mode-recent-activity%20comment:'%20in%20subject%20and%20please%20tell%20me%20whether%20or%20not%20it%20is%20OK%20to%20add%20your%20comment%20and%2For%20your%20email%20address%20to%20the%20blog%20entry!">Comment via email</a> or via <a href="//disqus.com">Disqus</a> comments below:
   </p>

    <div id="disqus_thread"></div>
    <div id="disqus_loader" style="text-align: center">
      <!-- stolen from http://blog.yjl.im/2012/04/let-your-readers-decide-when-to-load.html -->
      <button onclick="load_disqus()">Load Disqus Comments</button>
      <script>
        function load_disqus()
        {
          var dsq = document.createElement('script');
          dsq.type = 'text/javascript';
          dsq.async = true;
          dsq.src = "//yqrashawn.disqus.com/embed.js";
          var disqus_identifier = '2018-09-17-record-org-mode-recent-activity';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          var ldr = document.getElementById('disqus_loader');
          ldr.parentNode.removeChild(ldr);
        }
      </script>
    </div>
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">Disqus comments.</a></noscript>

    <footer>
      <p><i><a href="../../../../about">infin</a></i> is authored in <a href="//orgmode.org">Org-mode</a> and generated by <a href="https://github.com/novoid/lazyblorg">lazyblorg</a>

	 	&nbsp;&bull;&nbsp; <a href="//github.com/yqrashawn">Github</a>

	 	&nbsp;&bull;&nbsp; <a href="mailto:hi@yqrashawn.com">Mail</a>

	 	&nbsp;&bull;&nbsp; <a href="https://web.archive.org/web/*/yqrashawn.com/2018/09/17/record-org-mode-recent-activity/">Archive</a>
      </p>
    </footer>

  </body>
</html>